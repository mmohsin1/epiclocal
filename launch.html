<!DOCTYPE html>
<html> 
<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://mmohsin1.github.io/epiclocal/dist/fhir-client-v2.js">
		 
	</script>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
.buttonload {
  background-color: #04AA6D; /* Green background */
  border: none; /* Remove borders */
  color: white; /* White text */
  padding: 12px 24px; /* Some padding */
  font-size: 16px; /* Set a font-size */
}

/* Add a right margin to each icon */
.fa {
  margin-left: -12px;
  margin-right: 8px;
}
</style>
<body>
<!--	<h1 class="container" align="left">Hello, I am the page "launch.html"</h1>-->
	<br>
<button class="buttonload">
  <i class="fa fa-spinner fa-spin"></i>Authorizing
</button>
	<h1 class="container">Authorizing Request....</h1>

	<script>
		//get launch code and iss
    const metadata="https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/metadata";
    const authorization_endpoint="https://fhir.epic.com/interconnect-fhir-oauth/oauth2/authorize";
    const token_endpoint="https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token";
   
    //const metadata="https://icinstancestg.dha.gov.ae/Interconnect-TST-FHIR/api/FHIR/R4/metadata";
    //const authorization_endpoint="https://icinstancestg.dha.gov.ae/Interconnect-TST-FHIR/oauth2/authorize";
    //const token_endpoint="https://icinstancestg.dha.gov.ae/Interconnect-TST-FHIR/oauth2/token";
		//
    const urlParams = new URLSearchParams(window.location.search);
    const launch = urlParams.get('launch');
    const iss = urlParams.get('iss');
   	const clientId="b2774854-9deb-4b01-8e33-2f82a52a9cf0";//Liferay Patient Facing App
    	//const clientId="e405cbb8-1214-4c4c-9584-c0e5335c13ff";
    //step 1: authorize
    var myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/x-www-form-urlencoded");
 myHeaders.append("mode", "no-cors");
		
var requestOptions = {
  method: 'POST',
  headers: myHeaders
};
console.log('launch',launch);
console.log('iss',iss);

FHIR.oauth2.authorize({
  'response_type':'code',
'client_id': clientId,
'redirect_uri': encodeURI("https://mmohsin1.github.io/epiclocal/app"),
'scope':'launch',
'launch':launch,
'aud':iss,
'state':'palmira-'+new Date().getUTCMilliseconds()
});




	</script>

</body>

</html>
